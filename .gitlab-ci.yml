image: "ghcr.io/gtk-rs/gtk4-rs/gtk4:latest"

before_script:
  - curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y --profile minimal --default-toolchain nightly
  - source $HOME/.cargo/env
  - meson _build --prefix=/usr -Dlibadwaita:tests=false -Dlibadwaita:examples=false -Dlibadwaita:vapi=false
  - ninja -C _build install
  - git submodule update --init

build:
  script:
    - cargo build --all-features
    - xvfb-run -a -s "-screen 0 1024x768x24" cargo test

pages:
  script:
    # generate the docs
    - cargo install rustdoc-stripper
    - python3 ./generator.py --embed-docs --yes ./
    - cargo doc -p libadwaita -p libadwaita-sys --no-deps --features "dox"
    - mv target/doc/ public
  artifacts:
    paths:
      - public
  only:
    refs:
      - master
